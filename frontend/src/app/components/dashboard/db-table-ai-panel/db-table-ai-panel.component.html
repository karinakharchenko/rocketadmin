<div *ngIf="isAIpanelOpened"
    class="ai-panel-sidebar"
    [ngClass]="{'ai-panel-sidebar_open': isAIpanelOpened}">
</div>
<div class="ai-panel-sidebar-content">
    <div class="ai-panel-sidebar__header">
        <h2 class="mat-heading-2 ai-panel-sidebar__title">AI insights</h2>
        <button mat-icon-button (click)="handleClose()">
            <mat-icon>close</mat-icon>
        </button>
    </div>

    <div class="ai-panel-chat">
        <div class="ai-message-chain-box" #chatContainer>
            <div class="ai-message-chain">
                <div *ngFor="let message of messageChain" class="{{message.type}}-message">
                    <markdown>{{message.text}}</markdown>
                </div>
            </div>
        </div>



        <div class="loading">
            <div *ngIf="submitting">
                loading...
            </div>
        </div>

        <form (ngSubmit)="sendMessage()" class="ai-message-form">
            <mat-form-field class="form-field" appearance="outline" class="ai-message-form__textarea">
                <mat-label class="ai-message-form__label">Need data insights? Drop your query here!</mat-label>
                <textarea matInput name="message"
                    class="ai-panel-sidebar__message"
                    rows="5"
                    data-testid="user-message"
                    (keydown)="onKeydown($event)"
                    [(ngModel)]="message">
                </textarea>
            </mat-form-field>

            <button mat-icon-button type="submit"
                class="ai-message-form__button"
                (click)="sendMessage()">
                <mat-icon>send</mat-icon>
            </button>
        </form>
    </div>
</div>
