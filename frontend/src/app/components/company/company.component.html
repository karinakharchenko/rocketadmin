<app-alert></app-alert>

<div class="companyPage">
    <h1 class="mat-h1">
        Company settings
    </h1>
    <form class="company-name-settings" (ngSubmit)="changeCompanyName()">
        <mat-form-field appearance="outline" class="company-name-settings__name">
            <mat-label>Name</mat-label>
            <input matInput name="user-name" #nameField="ngModel"
                data-testid="user-name-input"
                [(ngModel)]="companyName">
        </mat-form-field>
        <button type="submit" mat-button color="primary"
            class="company-name-settings__save-button"
            [disabled]="!nameField.dirty || submittingChangedName">
            Save
        </button>
    </form>

    <div class="company-plan">
        <div>
            <strong>Current plan: </strong>
            <span>
                <span class="company-plan-name">{{currentPlan}}</span>
                <span *ngIf="currentPlan !== 'free'">
                    ({{ isAnnually ? 'annually' : 'monthly' }})
                </span>
            </span>
        </div>
        <a mat-button color="accent" class="upgrade-button"
            routerLink="/upgrade"
            class="user-settings__button"
            angulartics2On="click"
            angularticsAction="User settings: Manage payment settings is clicked">
            Manage payment settings
        </a>
    </div>

    <!--{{ members | json }}-->

    <div class="tableHeader">
        <h2 class="heading-2">Members <span *ngIf="currentPlan === 'free'">({{usersCount}}/3)</span></h2>
        <button mat-flat-button type="button" *ngIf="currentUser && currentUser.role === 'ADMIN'"
            class="tableHeader__button" color="primary"
            (click)="handleAddMemberDialogOpen()">
            Invite member
        </button>
    </div>

    <table *ngIf="currentUser && members.length" mat-table [dataSource]="members" class="mat-elevation-z4">
        <!-- Email Column -->
        <ng-container matColumnDef="email">
          <th mat-header-cell *matHeaderCellDef>Email</th>
          <td mat-cell *matCellDef="let element"> {{element.email}} </td>
        </ng-container>

        <!-- Name Column -->
        <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef>Name</th>
            <td mat-cell *matCellDef="let element">
                <span *ngIf="!element.invitedUserEmail">{{element.name || 'â€”'}}</span>
            </td>
        </ng-container>

        <!-- Role Column -->
        <ng-container matColumnDef="role">
          <th mat-header-cell *matHeaderCellDef>Role</th>
          <td mat-cell *matCellDef="let element">
            <!--<mat-icon *ngIf="element.role === 'ADMIN'" class="table-icon">bolt</mat-icon>-->
            {{element.role === "ADMIN" ? 'Superadmin' : 'Member'}}</td>
        </ng-container>

        <!-- Role Column -->
        <ng-container matColumnDef="twoFA">
            <th mat-header-cell *matHeaderCellDef>2fa status</th>
            <td mat-cell *matCellDef="let element">
                <div *ngIf="!element.invitedUserEmail">
                    <mat-icon *ngIf="element.is_2fa_enabled; else noTwoFA" color="accente">done</mat-icon>
                    <ng-template #noTwoFA>
                        <mat-icon>remove</mat-icon>
                    </ng-template>
                </div>
            </td>
        </ng-container>

        <!-- Delete Column -->
        <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let element">
                <button mat-button *ngIf="element.invitedUserEmail; else deleteUserButton"
                    type="button" color="warn"
                    (click)="revokeInvitation(element.email)">
                    Revoke
                </button>
                <ng-template #deleteUserButton>
                    <button mat-button *ngIf="adminsCount !== 1 || currentUser.role === 'ADMIN'"
                        type="button" color="warn"
                        (click)="handleDeleteMemberDialogOpen(element)">
                        Delete
                    </button>
                </ng-template>
            </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="membersTableDisplayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: membersTableDisplayedColumns;"></tr>
    </table>
</div>

